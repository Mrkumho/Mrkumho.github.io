# 쿠버네티스 Autoscaling : HPA와 VPA 개념 정리

---

## 1. 스케일링(Scaling)이란?

스케일링은 **서버나 애플리케이션의 리소스를 늘리거나 줄여 트래픽이나 부하에 맞춰 서비스를 안정적으로 운영하는 것**을 의미 함.

---

## 2. 스케일링의 두 가지 방식

### 2.1 수직 스케일링(Vertical Scaling)

- **정의**:  
  - **기존 서버(또는 파드)에 더 많은 CPU, 메모리 등 리소스를 추가**하는 방식
  - 예시: 물리 서버에 RAM을 추가, 파드의 리소스 요청/제한을 늘림
- **장점**:  
  - 간단하게 리소스만 늘리면 됨
- **단점**:  
  - 서버(또는 파드)를 중단해야 할 수 있음
  - 확장에 한계가 있음 (하드웨어 한계, 비용 등)

### 2.2 수평 스케일링(Horizontal Scaling)

- **정의**:  
  - **서버(또는 파드)의 개수를 늘려 부하를 분산**하는 방식
  - 예시: 웹 서버 인스턴스를 여러 대 추가, 파드 개수를 늘림
- **장점**:  
  - 서비스 중단 없이 확장 가능
  - 무한 확장(이론상) 가능
- **단점**:  
  - 추가 서버/파드 관리 필요

---

## 3. 쿠버네티스에서의 스케일링

쿠버네티스에서는 **워크로드(파드) 스케일링**과 **클러스터(노드) 스케일링**으로 나뉨.

### 3.1 워크로드 스케일링

- **수평 스케일링**: 파드 개수를 늘리거나 줄임 (Horizontal Pod Autoscaler, HPA)
- **수직 스케일링**: 파드의 리소스(CPU, 메모리)를 늘리거나 줄임 (Vertical Pod Autoscaler, VPA)

### 3.2 클러스터 스케일링

- **수평 스케일링**: 노드(서버) 개수를 늘리거나 줄임 (Cluster Autoscaler)
- **수직 스케일링**: 노드의 리소스를 늘리거나 줄임 (거의 사용하지 않음)

---

## 4. HPA(Horizontal Pod Autoscaler)

### 4.1 정의

- **HPA**는 **파드의 개수를 자동으로 조정**하는 오토스케일러.
- **CPU 사용률, 메모리 사용률, 커스텀 메트릭** 등을 기준으로 파드 개수를 늘리거나 줄임.

### 4.2 동작 방식

- **지표(예: CPU 사용률 70%)를 설정**하면,  
  HPA가 해당 지표를 모니터링하다가 기준을 초과하면 파드 개수를 늘리고,  
  기준 미만이면 파드 개수를 줄임.
- **예시 명령어**:
```bash
kubectl autoscale deployment my-app --cpu-percent=70 --min=2 --max=10
```

- `my-app` 디플로이먼트의 파드 개수를 CPU 사용률 70% 기준으로 2~10개로 자동 조정

### 4.3 장점

- **트래픽 변화에 자동으로 대응**
- **서비스 중단 없이 확장/축소 가능**

---

## 5. VPA(Vertical Pod Autoscaler)

### 5.1 정의

- **VPA**는 **파드의 리소스(CPU, 메모리) 요청/제한을 자동으로 조정**하는 오토스케일러.
- **파드의 실제 리소스 사용량을 분석**해,  
적절한 리소스 요청/제한 값을 추천하거나 자동으로 적용.

### 5.2 동작 방식

- **파드의 리소스 사용량을 모니터링**해  
너무 적거나 많은 리소스가 할당된 경우,  
**리소스 요청/제한 값을 조정**합니다.
- **예시 명령어**:
```bash
kubectl apply -f vpa.yaml
```

- `vpa.yaml`에 VPA 리소스 정의

### 5.3 장점

- **리소스 과소/과다 할당 방지**
- **비용 절감 및 안정성 향상**

### 5.4 주의사항

- **파드를 재생성해야 리소스 변경이 적용**될 수 있음
- **프로덕션 환경에서는 주의해서 사용** 필요

---

## 6. HPA vs VPA 비교

| 구분      | HPA (Horizontal Pod Autoscaler)      | VPA (Vertical Pod Autoscaler)         |
|-----------|--------------------------------------|---------------------------------------|
| 스케일링  | 파드 개수 늘리기/줄이기              | 파드 리소스(CPU, 메모리) 늘리기/줄이기 |
| 기준      | CPU, 메모리, 커스텀 메트릭           | 파드 실제 리소스 사용량                |
| 적용 방식 | 파드 생성/삭제                       | 파드 리소스 요청/제한 변경             |
| 장점      | 트래픽 변화에 자동 대응               | 리소스 과소/과다 할당 방지             |

---

## 7. 요약

- **HPA**: 파드 개수를 자동으로 조정해 트래픽에 맞춰 확장/축소
- **VPA**: 파드의 리소스(CPU, 메모리) 요청/제한을 자동으로 조정해 효율적 리소스 관리
- **클러스터 자동 확장**: Cluster Autoscaler로 노드 개수 자동 조정

---

> **핵심 문장**  
> **HPA는 파드 개수를, VPA는 파드 리소스를 자동으로 조정**하여  
> 쿠버네티스 워크로드를 효율적으로 관리할 수 있음.
