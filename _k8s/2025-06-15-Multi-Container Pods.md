
## 1. 모놀리식(Monolithic) vs 마이크로서비스

### 1.1 모놀리식 애플리케이션
- **정의**: 모든 기능이 하나의 큰 코드베이스에 통합된 구조  
  - 예: 웹 서버, 로깅, 데이터베이스가 하나의 프로그램으로 묶임
- **단점**:
  - 확장이 어려움 (전체 애플리케이션을 수정해야 함)
  - 유지보수 복잡

### 1.2 마이크로서비스 아키텍처
- **정의**: 애플리케이션을 작은 독립 서비스(컴포넌트)로 분리  
  - 예: 웹 서버, 로깅 서비스, DB를 각각 별도 서비스로 분리
- **장점**:
  - 독립적 개발/배포 가능
  - 특정 서비스만 확장(Scale Up/Down) 가능

---

## 2. 서비스 간 협업 필요성

### 2.1 문제 상황
- **예시**: 웹 서버와 로깅 서비스가 쌍으로 동작해야 함  
  - 웹 서버 인스턴스 1개당 로깅 에이전트 1개 필요
  - 두 서비스는 **함께 생성/삭제**되고 **동일하게 확장**되어야 함
- **요구사항**:
  - 각 서비스는 독립적으로 개발/배포되지만, **함께 동작**해야 함
  - **네트워크 통신**과 **스토리지 공유**가 필요

---

## 3. 멀티 컨테이너 파드(Multi-Container Pods)

### 3.1 개념
- **정의**: 하나의 파드(Pod) 안에 **여러 컨테이너**를 배치하는 방식
- **특징**:
  - **동일 생명주기**: 파드 생성 시 함께 생성, 파드 삭제 시 함께 삭제
  - **동일 네트워크 공간**: `localhost`로 서로 통신 가능
  - **동일 볼륨 공유**: 스토리지 볼륨을 함께 사용

### 3.2 예시 시나리오
- **웹 서버** + **로그 에이전트** 컨테이너를 하나의 파드에 배치
  - 웹 서버: `webapp` 컨테이너
  - 로그 에이전트: `log-agent` 컨테이너

---

## 4. 멀티 컨테이너 파드 YAML 예시
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webapp-with-logger
spec:
  containers:
    # 웹 서버 컨테이너
    - name: webapp
      image: kodekloud/webapp-color
      ports:
        - containerPort: 80
      volumeMounts:
        - name: log-volume
          mountPath: /var/log

    # 로그 에이전트 컨테이너
    - name: log-agent
      image: kodekloud/log-agent
      volumeMounts:
        - name: log-volume
          mountPath: /var/log

  # 파드 전체에서 공유되는 볼륨
  volumes:
    - name: log-volume
      emptyDir: {}
```

### 4.1 설명
- **컨테이너**:
  - `webapp`: 웹 서버 역할 (포트 80 개방)
  - `log-agent`: 로그 수집 및 전송
- **볼륨**:
  - `log-volume`: 두 컨테이너가 `/var/log` 경로에서 공유
- **통신**:
  - 웹 서버는 로그 에이전트를 `localhost`로 접근 가능

---

## 5. 멀티 컨테이너 파드의 장점

| 장점                  | 설명                                                                 |
|-----------------------|--------------------------------------------------------------------|
| **동기화된 확장**      | 웹 서버와 로그 에이전트가 항상 함께 스케일 업/다운                    |
| **간편한 통신**        | `localhost`로 통신 (외부 서비스 설정 불필요)                         |
| **볼륨 공유 용이**     | 동일 볼륨 마운트로 데이터 공유                                      |
| **리소스 효율성**      | 동일 파드 내 컨테이너가 리소스(CPU, 메모리)를 공유                   |

---

## 6. 멀티 컨테이너 파드 사용 사례

| 패턴              | 설명                                                                 |
|-------------------|--------------------------------------------------------------------|
| **사이드카(Sidecar)** | 주 컨테이너를 보조하는 컨테이너 (예: 로깅, 모니터링)                |
| **어댑터(Adapter)**   | 주 컨테이너의 출력을 표준화 (예: 로그 포맷 변환)                    |
| **앰배서더(Ambassador)** | 외부 서비스와의 연결을 대신 처리 (예: 프록시, 캐싱)               |

---

## 7. 요약

- **멀티 컨테이너 파드**는 함께 동작해야 하는 서비스를 묶는 최적의 방법임.
- **동일한 생명주기, 네트워크, 볼륨**을 공유하여 복잡성을 줄임.
- **사이드카, 어댑터, 앰배서더 패턴** 등 다양한 시나리오에 활용 가능.

---

> **핵심 문장**  
> "웹 서버와 로그 에이전트가 항상 함께 동작해야 한다면,  
> **멀티 컨테이너 파드**로 묶어 관리하는 것이 바람직함."
