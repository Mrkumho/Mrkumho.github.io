## 1. etcd란?
- **etcd**는 쿠버네티스에서 사용하는 **분산 키-값 저장소**  
  - 빠르고, 안전하며, 신뢰성 있는 데이터 저장을 제공
  - 클러스터의 설정, 서비스 디스커버리 등에 활용됨

## 2. etcd의 분산 구조와 리더 선출
- etcd를 여러 서버에 설치해 **클러스터**를 구성할 수 있음
- 모든 서버가 데이터 복제본을 유지(데이터 유실 방지)
- **리더(leader)**와 **팔로워(follower)** 구조  
  - **쓰기 요청**: 리더가 처리, 팔로워는 리더에게 전달  
  - **읽기 요청**: 모든 노드에서 가능  
- **리더 선출**: Raft 알고리즘 사용  
  - 각 노드는 랜덤 타이머로 리더 선출 요청
  - 다수의 투표를 받은 노드가 리더가 됨
  - 리더가 장애로 사라지면 자동으로 재선출

## 3. 데이터 일관성과 쿼럼(quorum)
- **쓰기 작업**은 리더가 다수 노드(쿼럼)에 데이터 복제 후 완료 처리
- 쿼럼: `(전체 노드 수 / 2) + 1`
  - 3노드: 2개(과반수)
  - 5노드: 3개
- 쿼럼을 만족하지 못하면 쓰기 불가(일관성 보장)

## 4. 노드 수와 고가용성(HA)
- **최소 3개 노드**로 클러스터 구성 권장
  - 1~2개 노드는 장애 시 쿼럼이 깨져 무의미
- **홀수(3, 5, 7...)**로 구성해야 네트워크 분할 상황에서 쿼럼 유지가 쉬움
- 5개 이상은 대부분의 환경에서 불필요(성능 저하, 관리 복잡성 ↑)

| 노드 수 | 쿼럼 | 장애 허용 노드 수 |
|---------|------|------------------|
| 3       | 2    | 1                |
| 5       | 3    | 2                |
| 7       | 4    | 3                |

## 5. etcd 클러스터 구성 방법
- 각 노드에 etcd 설치 후, 서로의 주소를 `initial-cluster` 옵션으로 지정
- 인증서(TLS)로 보안 설정 필요
- etcdctl 유틸리티로 데이터 저장/조회 가능
  - 예시:  
    ```
    ETCDCTL_API=3 etcdctl put name John
    ETCDCTL_API=3 etcdctl get name
    ```

## 6. 실전 팁
- **3노드 이상, 홀수로 구성**
- 마스터 노드와 etcd를 같은 서버에 두는 "stacked topology"가 간단(테스트 환경)
- 장애 허용/비용/성능을 고려해 노드 수 결정

---

> **핵심 요약**  
> - etcd는 쿠버네티스의 핵심 분산 데이터 저장소  
> - 리더-팔로워 구조, Raft 알고리즘으로 일관성/가용성 보장  
> - 쿼럼(과반수)이 중요, 3개 이상 홀수 노드 권장  
> - 장애 허용성과 관리 효율을 고려해 클러스터 크기 결정
